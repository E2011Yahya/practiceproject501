# Minimal example using environment vars or instance role credentials

# Example using constructed features to create groups and set ansible_host
plugin: aws_ec2
regions:
  - "us-east-1"

filters:
  # All instances with their `Environment` tag set to `dev`
  tag:app-stack-name: APP_STACK_NAME
  # All dev and QA hosts
  tag:Environment: dev 
   
keyed_groups:
  # Add hosts to tag_Name_Value groups for each Name/Value tag pair
  - prefix: 'app_stack_'
    key: tags['app-stack-name']
    separator: ''
  - prefix: 'role'
    key: tags['swarm-role']
    separator: ''    
  - prefix: 'env_'
    key: tags['environment']
    separator: '' 
  - key: tags['server']
    separator: ''  

hostnames:
  - "private-ip-address"    
compose:
  # Use the private IP address to connect to the host
  # (note: this does not modify inventory_hostname, which is set via I(hostnames))
  ansible_user: "'ec2-user'"